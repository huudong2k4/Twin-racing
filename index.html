<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Kaito Racing</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <script src="https://kit.fontawesome.com/a076d05399.js" crossorigin="anonymous"></script>
  <style>
    body {
      background-color: #f7f7f7;
    }
    header {
      background-color: #000;
      color: #fff;
      padding: 20px 0;
      text-align: center;
    }
    .product-img {
      height: 160px;
      object-fit: cover;
    }
    .product-card {
      transition: transform 0.2s, box-shadow 0.2s;
    }
    .product-card:hover {
      transform: scale(1.02);
      box-shadow: 0 4px 15px rgba(0,0,0,0.1);
    }
    .like-btn {
      border: none;
      background: transparent;
      font-size: 1.2rem;
      color: #ccc;
      transition: color 0.2s;
    }
    .like-btn.liked {
      color: red;
    }
  </style>
</head>
<body>

<header>
  <h1>Kaito Racing</h1>
  <p style="margin:0;">TikTok: <a href="https://tiktok.com/@huudong0003" target="_blank" style="color:#fff;">@huudong0003</a></p>
</header>

<div class="container py-4">
  <input id="searchInput" type="text" class="form-control mb-3" placeholder="Tìm kiếm sản phẩm...">
  <div id="productList" class="row g-3"></div>
</div>

<script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-database-compat.js"></script>
<script>
  const firebaseConfig = {
    databaseURL: "https://twinracing-default-rtdb.asia-southeast1.firebasedatabase.app"
  };
  firebase.initializeApp(firebaseConfig);
  const db = firebase.database();

  const productList = document.getElementById("productList");
  const searchInput = document.getElementById("searchInput");

  function renderProduct(id, product) {
    const col = document.createElement("div");
    col.className = "col-6 col-md-4 col-lg-3";
    col.innerHTML = `
      <div class="card product-card shadow-sm">
        <img src="${product.image}" class="card-img-top product-img" alt="${product.name}">
        <div class="card-body">
          <h6 class="card-title d-flex justify-content-between align-items-center">
            ${product.name}
            <button class="like-btn" data-id="${id}">
              <i class="fas fa-heart"></i>
            </button>
          </h6>
          <p class="card-text small">${product.description}</p>
          <p><strong>${Number(product.price).toLocaleString()}đ</strong></p>
          <a href="${product.link}" target="_blank" class="btn btn-success btn-sm w-100">Xem trên TikTok</a>
        </div>
      </div>
    `;
    productList.appendChild(col);
  }

  function updateLikeButtons() {
    document.querySelectorAll('.like-btn').forEach(btn => {
      const id = btn.getAttribute("data-id");
      if (localStorage.getItem(`liked-${id}`)) {
        btn.classList.add("liked");
      }
      btn.onclick = () => {
        if (btn.classList.contains("liked")) {
          btn.classList.remove("liked");
          localStorage.removeItem(`liked-${id}`);
        } else {
          btn.classList.add("liked");
          localStorage.setItem(`liked-${id}`, "true");
        }
      };
    });
  }

  function loadProducts() {
    db.ref("sanpham").on("value", (snapshot) => {
      productList.innerHTML = "";
      const search = searchInput.value.toLowerCase();
      snapshot.forEach(child => {
        const product = child.val();
        if (product.name.toLowerCase().includes(search)) {
          renderProduct(child.key, product);
        }
      });
      setTimeout(updateLikeButtons, 100);
    });
  }

  searchInput.addEventListener("input", loadProducts);
  loadProducts();
</script>
</body>
</html>
